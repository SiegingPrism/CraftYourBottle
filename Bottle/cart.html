<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Cart - CraftYourBottle Commerce</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F8FAFC;
        }

        /* Custom quantity input styling to hide spinners */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
    </style>
</head>

<body class="text-slate-800">

    <nav class="bg-white border-b border-gray-200 py-4">
        <div class="max-w-7xl mx-auto px-6 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <button onclick="toggleSidebar()"
                    class="p-2 -ml-2 mr-2 text-slate-600 hover:bg-slate-50 rounded-lg transition-colors">
                    <i class="fa-solid fa-bars-staggered text-xl"></i>
                </button>
                <a href="bottlecraft.html" class="flex items-center gap-2 decoration-0">
                    <i class="fa-solid fa-wine-bottle text-slate-700 text-xl"></i>
                    <span class="font-bold text-xl tracking-tight text-slate-800">CraftYourBottle</span>
                </a>
            </div>

            <div class="flex items-center gap-6 text-sm font-medium text-slate-600">
                <a href="bottlecraft.html" class="hover:text-slate-900 flex items-center gap-2">
                    <i class="fa-solid fa-house"></i> Home
                </a>
                <a href="#" class="hover:text-slate-900 flex items-center gap-2">
                    <i class="fa-solid fa-box-open"></i> Products
                </a>
                <a href="cart.html" class="bg-slate-800 text-white px-4 py-2 rounded-lg flex items-center gap-2">
                    <i class="fa-solid fa-cart-shopping"></i> Cart
                    <span class="bg-red-500 text-white text-[10px] font-bold px-1.5 rounded-full ml-1">3</span>
                </a>
                <a href="profile.html" class="hover:text-slate-900 flex items-center gap-2">
                    <i class="fa-regular fa-user"></i> Account
                </a>
                <a href="#" class="hover:text-slate-900 flex items-center gap-2">
                    <i class="fa-solid fa-clipboard-list"></i> Sell With Us
                </a>
            </div>
        </div>
    </nav>

    <section class="max-w-7xl mx-auto px-6 py-10">
        <h1 class="text-3xl font-bold text-slate-900 mb-8">Your Shopping Cart</h1>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

            <div class="lg:col-span-2">
                <div class="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden"
                    id="cart-items-container">
                    <!-- Cart items will be rendered here via JS -->
                    <div class="p-12 text-center text-slate-400">
                        <i class="fa-solid fa-spinner fa-spin text-2xl"></i> Loading cart...
                    </div>
                </div>

                <div class="mt-6">
                    <a href="bottlecraft.html"
                        class="text-sm font-medium text-slate-600 hover:text-slate-900 flex items-center gap-2">
                        <i class="fa-solid fa-arrow-left"></i> Continue Shopping
                    </a>
                </div>
            </div>

            <div class="lg:col-span-1">
                <div class="bg-white rounded-xl shadow-sm border border-slate-100 p-6 sticky top-6">
                    <h2 class="text-lg font-bold text-slate-900 mb-4">Order Summary</h2>

                    <div class="space-y-3 pb-4 border-b border-slate-100">
                        <div class="flex justify-between text-sm text-slate-600">
                            <span>Subtotal</span>
                            <span id="summary-subtotal">₹0.00</span>
                        </div>
                        <div class="flex justify-between text-sm text-slate-600">
                            <span>Shipping estimate</span>
                            <span id="summary-shipping" class="text-green-600 font-medium">Free</span>
                        </div>
                        <div class="flex justify-between text-sm text-slate-600">
                            <span>Tax estimate (18% GST)</span>
                            <span id="summary-tax">₹0.00</span>
                        </div>
                    </div>

                    <div class="py-4 flex justify-between items-center">
                        <span class="text-base font-bold text-slate-900">Order Total</span>
                        <span class="text-xl font-bold text-slate-900" id="summary-total">₹0.00</span>
                    </div>

                    <button
                        class="w-full bg-[#1e3a8a] text-white py-3 rounded-lg font-medium hover:bg-blue-900 transition flex items-center justify-center gap-2 shadow-lg shadow-blue-900/20 mb-4">
                        Proceed to Checkout <i class="fa-solid fa-arrow-right text-xs"></i>
                    </button>

                    <div class="pt-2">
                        <label class="block text-xs font-medium text-slate-500 mb-2">Promo Code</label>
                        <div class="flex gap-2">
                            <input type="text" placeholder="Enter code"
                                class="flex-1 border border-slate-200 rounded-md px-3 py-2 text-sm focus:outline-none focus:border-slate-400">
                            <button
                                class="bg-slate-100 text-slate-600 px-3 py-2 rounded-md text-sm font-medium hover:bg-slate-200">Apply</button>
                        </div>
                    </div>

                    <div class="mt-6 flex justify-center gap-4 text-slate-400 text-2xl">
                        <i class="fa-brands fa-cc-visa hover:text-[#1434CB]"></i>
                        <i class="fa-brands fa-cc-mastercard hover:text-[#EB001B]"></i>
                        <i class="fa-brands fa-cc-paypal hover:text-[#003087]"></i>
                        <i class="fa-brands fa-apple-pay hover:text-black"></i>
                    </div>
                    <div class="mt-4 flex items-center justify-center gap-2 text-[10px] text-slate-400">
                        <i class="fa-solid fa-lock"></i> Secure Encrypted Checkout
                    </div>
                </div>
            </div>

        </div>
    </section>

    <footer class="mt-auto border-t border-gray-200 bg-white py-8">
        <div class="max-w-7xl mx-auto px-6 text-center">
            <p class="text-slate-400 text-sm">&copy; 2024 CraftYourBottle Commerce. All rights reserved.</p>
        </div>
    </footer>


    <script src="nav.js"></script>
    <script src="cart_utils.js"></script>
    <script>
        // --- Cart Rendering Logic ---
        const cartContainer = document.getElementById('cart-items-container');
        const emptyCartMessage = `
            <div class="p-12 text-center">
                <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-slate-100 text-slate-400 mb-4">
                    <i class="fa-solid fa-cart-shopping text-2xl"></i>
                </div>
                <h3 class="text-lg font-bold text-slate-900">Your cart is empty</h3>
                <p class="text-slate-500 mt-2 mb-6">Looks like you haven't added anything yet.</p>
                <a href="bottlecraft.html" class="inline-block bg-slate-900 text-white px-6 py-2 rounded-lg font-medium hover:bg-slate-800 transition">
                    Start Shopping
                </a>
            </div>
        `;

        function renderCart() {
            const cart = getCart();

            if (cart.length === 0) {
                cartContainer.innerHTML = emptyCartMessage;
                updateSummary();
                return;
            }

            let html = `
                <div class="hidden md:grid grid-cols-12 gap-4 p-4 border-b border-slate-100 bg-slate-50 text-xs font-semibold text-slate-500 uppercase tracking-wide">
                    <div class="col-span-6">Product</div>
                    <div class="col-span-2 text-center">Price</div>
                    <div class="col-span-2 text-center">Quantity</div>
                    <div class="col-span-2 text-right">Total</div>
                </div>
            `;

            cart.forEach((item, index) => {
                const itemTotal = item.price * item.quantity;
                const formattedPrice = new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR' }).format(item.price);
                const formattedTotal = new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR' }).format(itemTotal);

                html += `
                <div class="p-4 border-b border-slate-100 flex flex-col md:grid md:grid-cols-12 gap-4 items-center">
                    <div class="col-span-6 flex items-center gap-4 w-full">
                        <div class="w-20 h-20 bg-gray-100 rounded-lg overflow-hidden flex-shrink-0 border border-slate-100">
                            <img src="${item.image || 'plastic_bottle.png'}" class="w-full h-full object-contain p-1">
                        </div>
                        <div>
                            <h3 class="font-bold text-slate-900 text-sm">${item.name}</h3>
                            <p class="text-xs text-slate-500 mt-1">${item.options ? Object.values(item.options).join(' / ') : ''}</p>
                            <p class="text-xs text-green-600 mt-1"><i class="fa-solid fa-check"></i> In Stock</p>
                        </div>
                    </div>

                    <div class="col-span-2 text-sm font-medium text-slate-900 text-center w-full md:w-auto flex justify-between md:block px-2 md:px-0">
                        <span class="md:hidden text-slate-500">Price:</span> ${formattedPrice}
                    </div>

                    <div class="col-span-2 flex justify-center w-full md:w-auto">
                        <div class="flex items-center border border-slate-200 rounded-md">
                            <button onclick="updateCartQuantity(${index}, -1)" class="px-2 py-1 text-slate-500 hover:bg-slate-50 hover:text-slate-800 transition"><i class="fa-solid fa-minus text-xs"></i></button>
                            <input type="number" value="${item.quantity}" readonly class="w-10 text-center text-sm font-medium border-x border-slate-200 focus:outline-none py-1 bg-white">
                            <button onclick="updateCartQuantity(${index}, 1)" class="px-2 py-1 text-slate-500 hover:bg-slate-50 hover:text-slate-800 transition"><i class="fa-solid fa-plus text-xs"></i></button>
                        </div>
                    </div>

                    <div class="col-span-2 text-right w-full md:w-auto flex justify-between md:block items-center px-2 md:px-0">
                        <span class="md:hidden text-slate-500 font-medium">Total:</span>
                        <div class="flex flex-col md:items-end gap-2">
                            <span class="font-bold text-slate-900">${formattedTotal}</span>
                            <button onclick="removeFromCartItem(${index})" class="text-xs text-red-500 hover:text-red-700 hover:underline"><i class="fa-regular fa-trash-can"></i> Remove</button>
                        </div>
                    </div>
                </div>`;
            });

            cartContainer.innerHTML = html;
            updateSummary();
        }

        function updateSummary() {
            const cart = getCart();
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const shipping = subtotal > 999 ? 0 : (subtotal === 0 ? 0 : 99); // Free shipping over 999
            const tax = subtotal * 0.18; // 18% GST estimate
            const total = subtotal + shipping + tax;

            document.getElementById('summary-subtotal').innerText = formatINR(subtotal);
            const elShipping = document.getElementById('summary-shipping');
            if (shipping === 0 && subtotal > 0) {
                elShipping.innerText = 'Free';
                elShipping.classList.add('text-green-600');
            } else {
                elShipping.innerText = formatINR(shipping);
                elShipping.classList.remove('text-green-600');
            }

            document.getElementById('summary-tax').innerText = formatINR(tax);
            document.getElementById('summary-total').innerText = formatINR(total);
        }

        function formatINR(amount) {
            return new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR' }).format(amount);
        }

        function updateCartQuantity(index, change) {
            updateQuantity(index, change);
            renderCart();
        }

        function removeFromCartItem(index) {
            if (confirm('Are you sure you want to remove this item?')) {
                removeFromCart(index);
                renderCart();
            }
        }

        renderCart();
    </script>
</body>

</html>